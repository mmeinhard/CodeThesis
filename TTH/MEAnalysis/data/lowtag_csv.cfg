[general]
do_stat_variations: False
do_fake_data: True
category_templates: template_sl template_dl
#definition of all process lists
process_lists:
  base_processes
  sl_data
  ttjets_powheg
#actually included in analysis
processes:
  base_processes
  sl_data
  ttjets_powheg
analysis_groups:
  group_inclusive
  group_2tag
  group_3tag
name: lowtag_csv
debug: false
mem_python_config: $CMSSW_BASE/src/TTH/MEAnalysis/python/MEAnalysis_cfg_heppy.py

#calculated using calcLumis.py
[lumi]
SingleMuon: 0.0
SingleElectron: 0.0
DoubleMuon: 0.0
DoubleEG: 0.0
MuonEG: 0.0
BTagCSV: 0.0
Common: 3970.0

[sparsinator]
do_classifier_db: false
calculate_bdt: true
add_systematics: true
#which categories to create in sparsinator

###
### Systematics
###
[systematics]

#systematics that change the event topology
event:
  CMS_scale_j
  CMS_res_j
  CMS_scaleSubTotalPileUp_j
  CMS_scaleAbsoluteStat_j
  CMS_scaleAbsoluteScale_j
  CMS_scaleAbsoluteFlavMap_j
  CMS_scaleAbsoluteMPFBias_j
  CMS_scaleFragmentation_j
  CMS_scaleSinglePionECAL_j
  CMS_scaleSinglePionHCAL_j
  CMS_scaleFlavorQCD_j
  CMS_scaleTimePtEta_j
  CMS_scaleRelativeJEREC1_j
  CMS_scaleRelativeJEREC2_j
  CMS_scaleRelativeJERHF_j
  CMS_scaleRelativePtBB_j
  CMS_scaleRelativePtEC1_j
  CMS_scaleRelativePtEC2_j
  CMS_scaleRelativePtHF_j
  CMS_scaleRelativeFSR_j
  CMS_scaleRelativeStatFSR_j
  CMS_scaleRelativeStatEC_j
  CMS_scaleRelativeStatHF_j
  CMS_scalePileUpDataMC_j
  CMS_scalePileUpPtRef_j
  CMS_scalePileUpPtBB_j
  CMS_scalePileUpPtEC1_j
  CMS_scalePileUpPtEC2_j
  CMS_scalePileUpPtHF_j
weight:
  CMS_ttH_CSVcferr1
  CMS_ttH_CSVcferr2
  CMS_ttH_CSVhf
  CMS_ttH_CSVhfstats1
  CMS_ttH_CSVhfstats2
  CMS_ttH_CSVjes
  CMS_ttH_CSVlf
  CMS_ttH_CSVlfstats1
  CMS_ttH_CSVlfstats2
  CMS_pu
sample:
#  CMS_ttjetsisr
#  CMS_ttjetsfsr

#individual systematics
[nominal]

[CMS_scale_jUp]
#suffix is used to get the systematically variated value from the MEM tree (numJets -> numJets_TotalUp)
suffix: TotalUp

[CMS_scale_jDown]
suffix: TotalDown

[CMS_res_jUp]
suffix: JERUp

[CMS_res_jDown]
suffix: JERDown
#the other event-based systematics are automatically derived, as the name is the same as the the scenario defined in sparsinator

[CMS_ttjetsisr]
process_list_up: ttjets_powheg_isr_up
process_list_down: ttjets_powheg_isr_down

[CMS_ttjetsfsr]
process_list_up: ttjets_powheg_fsr_up
process_list_down: ttjets_powheg_fsr_down

###
### Samples
###
#These are all the MINIAOD-level generated samples along with their normalization
#info, schema (if they are data or not)
[samples]
samples_list:
  ttHTobb_M125_TuneCUETP8M2_ttHtranche3_13TeV-powheg-pythia8
  TT_TuneCUETP8M2T4_13TeV-powheg-pythia8
  SingleMuon
#  SingleElectron

[ttHTobb_M125_TuneCUETP8M2_ttHtranche3_13TeV-powheg-pythia8]
files_load: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/Mar27_2tag_v2/ttHTobb_M125_TuneCUETP8M2_ttHtranche3_13TeV-powheg-pythia8.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/Mar27_2tag_v2/ttHTobb_M125_TuneCUETP8M2_ttHtranche3_13TeV-powheg-pythia8.txt
step_size_sparsinator: 1
debug_max_files: 10
ngen: 3687873
classifier_db_path:
schema: mc
skim_file:
#https://twiki.cern.ch/twiki/bin/view/LHCPhysics/CERNYellowReportPageAt1314TeV#s_13_0_TeV
#0.5085 * 0.577
xsec: 0.2934045
vhbb_tree_name: vhbb/tree
test_events: 1000 

[TT_TuneCUETP8M2T4_13TeV-powheg-pythia8]
files_load: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/Apr20_cmssw_v2/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/Apr20_cmssw_v2/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8.txt
step_size_sparsinator: 20
debug_max_files: 10
ngen: 75499181
classifier_db_path:
schema: mc
skim_file:
xsec: 831.76
vhbb_tree_name: vhbb/tree
test_events: 1000 

[SingleMuon]
files_load: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/Apr20_cmssw_v1/SingleMuon.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/Apr20_cmssw_v1/SingleMuon.txt
step_size_sparsinator: 1
debug_max_files: 500
ngen: -1
schema: data
classifier_db_path:
process: data_m
skim_file:
xsec: 1.0
vhbb_tree_name: vhbb/tree
test_events: 50000

[SingleElectron]
files_load: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/Apr15_fixpv/SingleElectron.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/Apr15_fixpv/SingleElectron.txt
step_size_sparsinator: 1
debug_max_files: 500
ngen: -1
schema: data
classifier_db_path:
process: data_m
skim_file:
xsec: 1.0
vhbb_tree_name: tree
test_events: 50000

###
### Processes
###
[process_index]
ttH_hbb: 0
ttH_nonhbb: 1
ttbarPlusBBbar: 2
ttbarPlus2B: 3
ttbarPlusB: 4
ttbarPlusCCbar: 5
ttbarOther: 6
qcd: 13
ww: 14
wz: 15
zz: 16
st_t: 17
stbar_t: 18
st_tw: 19
stbar_tw: 19
st_s: 21
ttw_wqq: 22
ttw_wlnu: 22
ttz_zqq: 23
ttz_zllnunu: 24
ttjetsUnsplit: 26
wjets_ht_100_200: 27
wjets_ht_200_400: 28
wjets_ht_400_600: 29
wjets_ht_600_800: 30
wjets_ht_600_800: 31
wjets_ht_800_1200: 32
wjets_ht_1200_2500: 33
wjets_ht_2500_inf: 34
data_e: 7
data_m: 8
data_mm: 9
data_ee: 10
data_em: 11
data_fh: 12

###
### Cuts
###

[cuts]
cuts_list:
  triggerPath_m
  triggerPath_e
  triggerPath_mm
  triggerPath_em
  triggerPath_ee
  triggerPath_fh
  process_ttbarPlusBBbar
  process_ttbarPlus2B
  process_ttbarPlusB
  process_ttbarPlusCCbar
  process_ttbarOther

[triggerPath_m]
sparsinator:
  triggerPath 1 2
skim: (is_sl==1 && HLT_ttH_SL_mu==1 && abs(leps_pdgId[0])==13)

[triggerPath_e]
sparsinator:
  triggerPath 2 3
skim: (is_sl==1 && HLT_ttH_SL_el==1 && abs(leps_pdgId[0])==11)

[triggerPath_mm]
sparsinator:
  triggerPath 3 4
skim: (is_dl==1 && HLT_ttH_DL_mumu==1 && abs(leps_pdgId[0])==13 && abs(leps_pdgId[1])==13)

[triggerPath_em]
sparsinator:
  triggerPath 4 5
skim: (is_dl==1 && HLT_ttH_DL_elmu==1 && ((abs(leps_pdgId[0])==13 && abs(leps_pdgId[1])==11) || (abs(leps_pdgId[0])==11 && abs(leps_pdgId[1])==13)))

[triggerPath_ee]
sparsinator:
  triggerPath 5 6
skim: (is_dl==1 && HLT_ttH_DL_elel==1 && abs(leps_pdgId[0])==11 && abs(leps_pdgId[1])==11)

[triggerPath_fh]
sparsinator:
  triggerPath 5 6
skim: (is_dl==1 && HLT_ttH_DL_elel==1 && abs(leps_pdgId[0])==11 && abs(leps_pdgId[1])==11)

[process_ttbarPlusBBbar]
sparsinator:
  ttCls 53 60
skim: (ttCls >= 53)

[process_ttbarPlus2B]
sparsinator:
  ttCls 52 53
skim: (ttCls == 52)

[process_ttbarPlusB]
sparsinator:
  ttCls 51 52
skim: (ttCls == 51)

[process_ttbarPlusCCbar]
sparsinator:
  ttCls 41 46
skim: (ttCls >= 41 && ttCls <= 45)

[process_ttbarOther]
sparsinator:
  ttCls 0 1
skim: (ttCls == 0)

###
### Process groups
###

#common for all kinds of analyses
[base_processes]
split_by_trigger_path: false
schema: mc
processes:
  ttH_hbb

[ttjets_powheg]
split_by_trigger_path: false
schema: mc
processes:
  ttjets_powheg_ttbarOther
  ttjets_powheg_ttbarPlusBBbar 
  ttjets_powheg_ttbarPlus2B
  ttjets_powheg_ttbarPlusB
  ttjets_powheg_ttbarPlusCCbar

# Single-leptonic data
[sl_data]
split_by_trigger_path: false
schema: data
processes:
  data_m
#  data_e

###
### MC processes
###

[ttH_hbb]
in: ttHTobb_M125_TuneCUETP8M2_ttHtranche3_13TeV-powheg-pythia8
out: ttH_hbb
index: 0

[ttjets_powheg_ttbarOther]
in: TT_TuneCUETP8M2T4_13TeV-powheg-pythia8
out: ttbarOther
cuts: process_ttbarOther

[ttjets_powheg_ttbarPlusBBbar]
in: TT_TuneCUETP8M2T4_13TeV-powheg-pythia8
out: ttbarPlusBBbar
cuts: process_ttbarPlusBBbar

[ttjets_powheg_ttbarPlus2B]
in: TT_TuneCUETP8M2T4_13TeV-powheg-pythia8
out: ttbarPlus2B
cuts: process_ttbarPlus2B

[ttjets_powheg_ttbarPlusB]
in: TT_TuneCUETP8M2T4_13TeV-powheg-pythia8
out: ttbarPlusB
cuts: process_ttbarPlusB

[ttjets_powheg_ttbarPlusCCbar]
in: TT_TuneCUETP8M2T4_13TeV-powheg-pythia8
out: ttbarPlusCCbar
cuts: process_ttbarPlusCCbar


###
### Data processes
###

[data_m]
in: SingleMuon
out: data
lumi: SingleMuon
cuts: triggerPath_m

[data_e]
in: SingleElectron
out: data
lumi: SingleElectron
cuts: triggerPath_e

[common_shape_uncertainties]
CMS_res_j: 1
#CMS_scale_j: 1
CMS_scaleAbsoluteStat_j: 1
CMS_scaleAbsoluteScale_j: 1
CMS_scaleAbsoluteFlavMap_j: 1
CMS_scaleAbsoluteMPFBias_j: 1
CMS_scaleFragmentation_j: 1
CMS_scaleSinglePionECAL_j: 1
CMS_scaleSinglePionHCAL_j: 1
CMS_scaleFlavorQCD_j: 1
CMS_scaleTimePtEta_j: 1
CMS_scaleRelativeJEREC1_j: 1
CMS_scaleRelativeJEREC2_j: 1
CMS_scaleRelativeJERHF_j: 1
CMS_scaleRelativePtBB_j: 1
CMS_scaleRelativePtEC1_j: 1
CMS_scaleRelativePtEC2_j: 1
CMS_scaleRelativePtHF_j: 1
CMS_scaleRelativeFSR_j: 1
CMS_scaleRelativeStatFSR_j: 1
CMS_scaleRelativeStatEC_j: 1
CMS_scaleRelativeStatHF_j: 1
CMS_scalePileUpDataMC_j: 1
CMS_scalePileUpPtRef_j: 1
CMS_scalePileUpPtBB_j: 1
CMS_scalePileUpPtEC1_j: 1
CMS_scalePileUpPtEC2_j: 1
CMS_scalePileUpPtHF_j: 1
CMS_ttH_CSVcferr1: 1
CMS_ttH_CSVcferr2: 1
CMS_ttH_CSVhf: 1
CMS_ttH_CSVhfstats1: 1
CMS_ttH_CSVhfstats2: 1
CMS_ttH_CSVjes: 1
CMS_ttH_CSVlf: 1
CMS_ttH_CSVlfstats1: 1
CMS_ttH_CSVlfstats2: 1
CMS_pu: 1
CMS_ttjetsfsr: 1
CMS_ttjetsisr: 1

[common_scale_uncertainties]
lumi: 1.045

[scale_uncertainties]
#ttH_hbb:
#  QCDscale_ttH 1.133
#  pdf_gg 1.083
ttbarPlus2B:
  bgnorm_ttbarPlus2B 1.5
  QCDscale_ttbar 1.030
  pdf_gg 1.026
ttbarPlusB:
  bgnorm_ttbarPlusB 1.5
  QCDscale_ttbar 1.030
  pdf_gg 1.026
ttbarPlusBBbar:
  bgnorm_ttbarPlusBBbar 1.5
  QCDscale_ttbar 1.030
  pdf_gg 1.026
ttbarPlusCCbar:
  bgnorm_ttbarPlusCCbar 1.5
  QCDscale_ttbar 1.030
  pdf_gg 1.026
ttbarOther:
  QCDscale_ttbar 1.030
  pdf_gg 1.026

[group_inclusive]
categories: 
  sl_jge3

[group_2tag]
categories: 
  sl_j4_t2
  sl_j5_t2
  sl_jge6_t2

[group_3tag]
categories: 
  sl_j4_t3
  sl_j5_t3

[template_sl]
mc_processes:
  base_processes
  ttjets_powheg
data_processes:
  sl_data
common_shape_uncertainties: common_shape_uncertainties
common_scale_uncertainties: common_scale_uncertainties
scale_uncertainties: scale_uncertainties
src_histogram: sl/sparse
signal_processes:
  ttH_hbb

[sl_jge6_t2]
template: template_sl
discriminator: jetsByPt_0_btagCSV jetsByPt_0_btagCSV 30,0,1
control_variables: 
  jetsByPt_0_pt jetsByPt_0_pt 30,0,400
  btag_LR_4b_2b_btagCSV_logit btag_LR_4b_2b_btagCSV_logit 20,0,20
cuts:
  is_sl 1 2
  numJets 6 8
  nBCSVM 2 3

[sl_jge3]
template: template_sl
discriminator: leps_0_pt leps_0_pt 30,0,300
control_variables: 
  jetsByPt_0_pt jetsByPt_0_pt 30,0,400
  jetsByPt_0_btagCSV jetsByPt_0_btagCSV 30,0,1
  btag_LR_4b_2b_btagCSV_logit btag_LR_4b_2b_btagCSV_logit 30,-10,10
cuts:
  is_sl 1 2
  numJets 3 10

[sl_j5_t2]
template: template_sl
discriminator: jetsByPt_0_btagCSV jetsByPt_0_btagCSV 30,0,1
control_variables: 
  jetsByPt_0_pt jetsByPt_0_pt 30,0,400
  leps_0_pt leps_0_pt 30,0,300
  btag_LR_4b_2b_btagCSV_logit btag_LR_4b_2b_btagCSV_logit 30,-2,8
cuts:
  is_sl 1 2
  numJets 5 6 
  nBCSVM 2 3

[sl_j5_t3]
template: template_sl
discriminator: jetsByPt_0_btagCSV jetsByPt_0_btagCSV 30,0,1
control_variables: 
  jetsByPt_0_pt jetsByPt_0_pt 30,0,400
  leps_0_pt leps_0_pt 30,0,300
  btag_LR_4b_2b_btagCSV_logit btag_LR_4b_2b_btagCSV_logit 30,-2,8
cuts:
  is_sl 1 2
  numJets 5 6 
  nBCSVM 3 4

[sl_j4_t3]
template: template_sl
discriminator: jetsByPt_0_btagCSV jetsByPt_0_btagCSV 30,0,1
control_variables:
  jetsByPt_0_pt jetsByPt_0_pt 30,0,400
  btag_LR_4b_2b_btagCSV_logit btag_LR_4b_2b_btagCSV_logit 30,-2,8
  leps_0_pt leps_0_pt 30,0,300
cuts:
  is_sl 1 2
  numJets 4 5
  nBCSVM 3 4

[sl_j4_t2]
template: template_sl
discriminator: jetsByPt_0_btagCSV jetsByPt_0_btagCSV 30,0,1
control_variables: 
  leps_0_pt leps_0_pt 30,0,300
  jetsByPt_0_pt jetsByPt_0_pt 30,0,400
  btag_LR_4b_2b_btagCSV_logit btag_LR_4b_2b_btagCSV_logit 30,-2,8
cuts:
  is_sl 1 2
  numJets 4 5
  nBCSVM 2 3
